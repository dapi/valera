# Feature Implementation Plan: FIP-002b - Telegram Recording + Booking

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** High
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** Simple (LLM Tool –ø–æ–¥—Ö–æ–¥)
**–°—Ç–∞—Ç—É—Å:** Draft
**–°–æ–∑–¥–∞–Ω:** 25.10.2025
**–û–±–Ω–æ–≤–ª–µ–Ω:** 25.10.2025
**User Story:** US-002b-telegram-recording-booking.md
**Dependencies:** US-001 (–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ), FIP-002a (–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è)

## üéØ User Story

**As a** –≤–ª–∞–¥–µ–ª–µ—Ü –∞–≤—Ç–æ–º–æ–±–∏–ª—è, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∏–ª –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ–º–æ–Ω—Ç–∞ –∏ —Ö–æ—á–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Å–º–æ—Ç—Ä
**I want to** –±—ã—Å—Ç—Ä–æ –∏ —É–¥–æ–±–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –æ—Å–º–æ—Ç—Ä —á–µ—Ä–µ–∑ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥ –≤ Telegram
**so that** —è –º–æ–≥—É –ø–æ–ª—É—á–∏—Ç—å —Ç–æ—á–Ω—É—é –æ—Ü–µ–Ω–∫—É —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —Ä–µ–º–æ–Ω—Ç –≤ —É–¥–æ–±–Ω–æ–µ –¥–ª—è –º–µ–Ω—è –≤—Ä–µ–º—è

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏
- [ ] **Functional:** –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –æ—Å–º–æ—Ç—Ä —á–µ—Ä–µ–∑ –¥–∏–∞–ª–æ–≥, –±–æ—Ç —Å–æ–∑–¥–∞–µ—Ç –∑–∞—è–≤–∫—É –≤ –º–µ–Ω–µ–¥–∂–µ—Ä—Å–∫–∏–π —á–∞—Ç
- [ ] **User Experience:** 60% –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –≤ –∑–∞–ø–∏—Å—å, 90% –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–∞ –æ—Å–º–æ—Ç—Ä
- [ ] **Performance:** Response time < 3 —Å–µ–∫—É–Ω–¥, –∑–∞—è–≤–∫–∏ –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º –º–≥–Ω–æ–≤–µ–Ω–Ω–æ

## üèóÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (LLM Tool Approach)
```yaml
components:
  - name: "TelegramWebhookController"
    type: "Controller"
    responsibility: "–ü—Ä–∏–µ–º webhook –æ—Ç Telegram, –ø–µ—Ä–µ–¥–∞—á–∞ –≤ LLM"
    implementation_status: "‚úÖ –ì–û–¢–û–í–û (—Ç—Ä–µ–±—É–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π)"

  - name: "BookingCreator Tool"
    type: "LLM Tool (ruby_llm)"
    responsibility: "–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ tool calling mechanism"
    implementation_status: "‚ö†Ô∏è –ù–£–ñ–ù–ê –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø"

  - name: "BookingNotificationJob"
    type: "Job"
    responsibility: "–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–æ–∫ –≤ –º–µ–Ω–µ–¥–∂–µ—Ä—Å–∫–∏–π —á–∞—Ç"
    implementation_status: "‚ö†Ô∏è –ù–£–ñ–ù–ê –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø"

  - name: "Booking –º–æ–¥–µ–ª—å"
    type: "Model"
    responsibility: "–•—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫ —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏"
    implementation_status: "‚ö†Ô∏è –ù–£–ñ–ù–ê –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø"

  - name: "Chat/Message (ruby_llm)"
    type: "Models"
    responsibility: "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤, tool registration"
    implementation_status: "‚úÖ –ì–û–¢–û–í–û"
```

### ü§ñ LLM Tool System Design

**Core Concept:** –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π **tool calling** –º–µ—Ö–∞–Ω–∏–∑–º ruby_llm –¥–ª—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ AI.

```ruby
# Tool Registration –≤ Chat –º–æ–¥–µ–ª–∏
class Chat < ApplicationRecord
  acts_as_chat

  tool :booking_creator,
       description: "–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ –æ—Å–º–æ—Ç—Ä –≤ –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å",
       parameters: {
         type: "object",
         properties: {
           customer_name: { type: "string", description: "–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞" },
           customer_phone: { type: "string", description: "–¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞" },
           car_info: {
             type: "object",
             properties: {
               brand: { type: "string" },
               model: { type: "string" },
               year: { type: "integer" },
               car_class: { type: "integer", description: "–ö–ª–∞—Å—Å –∞–≤—Ç–æ–º–æ–±–∏–ª—è (1/2/3)" }
             }
           },
           preferred_date: { type: "string", description: "–ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–∞—è –¥–∞—Ç–∞ (LLM –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–∑ –¥–∏–∞–ª–æ–≥–∞)" },
           preferred_time: { type: "string", description: "–ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è (LLM –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–∑ –¥–∏–∞–ª–æ–≥–∞)" }
         },
         required: ["customer_name", "customer_phone", "car_info"]
       }
end
```

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **Framework:** Ruby on Rails 8.1
- **AI:** ruby_llm gem (acts_as_chat, acts_as_message)
- **Background Jobs:** Solid Queue
- **External:** Telegram API
- **Database:** PostgreSQL

### Data Flow (LLM Tool Approach)
```mermaid
graph LR
    A[–ö–ª–∏–µ–Ω—Ç: "–•–æ—á—É –∑–∞–ø–∏—Å–∞—Ç—å—Å—è"] --> B[TelegramWebhookController]
    B --> C[ruby_llm Chat.ask]
    C --> D[AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç intent]
    D --> E[–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞]
    E --> F[–í—ã–∑–æ–≤ booking_creator tool]
    F --> G[Booking.create]
    G --> H[BookingNotificationJob.perform_later]
    H --> I[Manager Chat Notification]
    I --> J[Client Confirmation]
```

### üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Tool System

#### **–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥**
```
–ö–ª–∏–µ–Ω—Ç: –î–∞, —Ö–æ—á—É –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –æ—Å–º–æ—Ç—Ä –∑–∞–≤—Ç—Ä–∞ —É—Ç—Ä–æ–º

LLM Process:
1. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç intent: "–∑–∞–ø–∏—Å—å –Ω–∞ –∑–∞–≤—Ç—Ä–∞ —É—Ç—Ä–æ–º"
2. –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞:
   - customer_name: "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä" (–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π)
   - customer_phone: "+7(916)123-45-67" (–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
   - car_info: {brand: "Toyota", model: "Camry", year: 2018}
3. –í—ã–∑—ã–≤–∞–µ—Ç booking_creator tool —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–ª–∏–µ–Ω—Ç—É
```

#### **–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ó–∞–ø—Ä–æ—Å —É—Ç–æ—á–Ω—è—é—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏**
```
–ö–ª–∏–µ–Ω—Ç: –•–æ—á—É –∑–∞–ø–∏—Å–∞—Ç—å—Å—è

LLM: –î–ª—è –∑–∞–ø–∏—Å–∏ –º–Ω–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è:
üöó –ú–∞—Ä–∫–∞, –º–æ–¥–µ–ª—å –∏ –≥–æ–¥ –≤–∞—à–µ–≥–æ –∞–≤—Ç–æ
üìû –í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
‚è∞ –ö–æ–≥–¥–∞ —É–¥–æ–±–Ω–æ –ø—Ä–∏–µ—Ö–∞—Ç—å?

–ö–ª–∏–µ–Ω—Ç: Toyota Camry 2018, +7(916)123-45-67, –∑–∞–≤—Ç—Ä–∞ –≤ 10:00

LLM: –í—ã–∑—ã–≤–∞–µ—Ç booking_creator tool —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
```

## üìã –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (LLM Tool Approach - Simplified)

### Phase 1: Foundation (1 –¥–µ–Ω—å)
- [ ] –°–æ–∑–¥–∞—Ç—å Booking –º–æ–¥–µ–ª—å
  - –ü–æ–ª—è: customer_name, customer_phone, car_brand, car_model, car_year, preferred_date (date), preferred_time (string), status
  - –°–≤—è–∑–∏ —Å TelegramUser –∏ Chat
  - –í–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö (—Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å BookingCreatorTool
  - Tool handler –¥–ª—è ruby_llm
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  - –°–æ–∑–¥–∞–Ω–∏–µ Booking –∑–∞–ø–∏—Å–∏
- [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å tool –≤ Chat –º–æ–¥–µ–ª–∏
  - Tool definition —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
  - Handler registration
  - Error handling

### Phase 2: Integration (1 –¥–µ–Ω—å)
- [ ] –°–æ–∑–¥–∞—Ç—å BookingNotificationJob
  - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
  - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –º–µ–Ω–µ–¥–∂–µ—Ä—Å–∫–∏–π —á–∞—Ç
  - Retry –º–µ—Ö–∞–Ω–∏–∑–º
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
  - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ tool usage
  - –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã (–∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–µ)
  - –ü—Ä–∞–≤–∏–ª–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
- [ ] –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ TelegramWebhookController
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ tool responses (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ ruby_llm)
  - –ë–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### Phase 3: Polish (0.5 –¥–Ω—è)
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã
  - Tool calling —Ç–µ—Å—Ç—ã
  - Integration —Ç–µ—Å—Ç—ã –ø–æ–ª–Ω–æ–≥–æ flow
  - Unit —Ç–µ—Å—Ç—ã –¥–ª—è Booking –º–æ–¥–µ–ª–∏
- [ ] UX –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
  - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases
  - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫

**Total Implementation Time: 2.5 –¥–Ω—è (vs 4 –¥–Ω—è –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º –ø–ª–∞–Ω–µ)**

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Tool System

### BookingCreatorTool Implementation

```ruby
# app/tools/booking_creator_tool.rb
class BookingCreatorTool
  def self.call(parameters:, context:)
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    return error_response("–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ") unless required_params_present?(parameters)

    # –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
    # LLM —Å–∞–º–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞ (Product Constitution compliance)
  booking = Booking.new(
      customer_name: parameters[:customer_name],
      customer_phone: parameters[:customer_phone],
      car_brand: parameters[:car_info][:brand],
      car_model: parameters[:car_info][:model],
      car_year: parameters[:car_info][:year],
      car_class: parameters[:car_info][:car_class],
      preferred_date: parameters[:preferred_date], # LLM –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–∞–º–∞
      preferred_time: parameters[:preferred_time], # LLM –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–∞–º–∞
      telegram_user: context[:telegram_user],
      chat: context[:chat],
      status: :pending
    )

    if booking.save
      # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –º–µ–Ω–µ–¥–∂–µ—Ä—Å–∫–∏–π —á–∞—Ç
      BookingNotificationJob.perform_later(booking)

      success_response(booking)
    else
      error_response("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å: #{booking.errors.full_messages.join(', ')}")
    end
  end

  # LLM —Å–∞–º–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤—Ä–µ–º—è –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞
# –ù–∏–∫–∞–∫–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–ª–∏ –º–∞–ø–ø–∏–Ω–≥–∞ —Å–æ–≥–ª–∞—Å–Ω–æ Product Constitution

  def self.success_response(booking)
    {
      success: true,
      message: "‚úÖ –ó–∞–ø–∏—Å–∞–ª –≤–∞—Å –Ω–∞ #{booking.preferred_date} –≤ #{booking.preferred_time}! üìç –≥. –ß–µ–±–æ–∫—Å–∞—Ä—ã, –Ø–¥—Ä–∏–Ω—Å–∫–æ–µ —à., 3\n–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–µ—Ä–µ–∑–≤–æ–Ω–∏—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.",
      booking_id: booking.id
    }
  end

  def self.error_response(message)
    {
      success: false,
      message: "‚ùå #{message}. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
    }
  end

  def self.required_params_present?(parameters)
    parameters[:customer_name].present? &&
    parameters[:customer_phone].present? &&
    parameters[:car_info]&.dig(:brand).present? &&
    parameters[:car_info]&.dig(:model).present? &&
    parameters[:car_info]&.dig(:year).present?
  end
end
```

### Chat Model —Å Tool Registration

```ruby
# app/models/chat.rb
class Chat < ApplicationRecord
  acts_as_chat

  belongs_to :telegram_user
  has_many :messages, dependent: :destroy
  has_many :bookings, dependent: :destroy

  # Tool –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
  tool :booking_creator,
       description: "–°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ –æ—Å–º–æ—Ç—Ä –≤ –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å",
       handler: "BookingCreatorTool",
       parameters: {
         type: "object",
         properties: {
           customer_name: {
             type: "string",
             description: "–ü–æ–ª–Ω–æ–µ –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞"
           },
           customer_phone: {
             type: "string",
             description: "–¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ +7(XXX)XXX-XX-XX"
           },
           car_info: {
             type: "object",
             description: "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≤—Ç–æ–º–æ–±–∏–ª–µ –∫–ª–∏–µ–Ω—Ç–∞",
             properties: {
               brand: { type: "string", description: "–ú–∞—Ä–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è" },
               model: { type: "string", description: "–ú–æ–¥–µ–ª—å –∞–≤—Ç–æ–º–æ–±–∏–ª—è" },
               year: { type: "integer", description: "–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è" },
               car_class: { type: "integer", description: "–ö–ª–∞—Å—Å –∞–≤—Ç–æ–º–æ–±–∏–ª—è (1/2/3)" }
             },
             required: ["brand", "model", "year"]
           },
           preferred_date: {
             type: "string",
             description: "–ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–∞—è –¥–∞—Ç–∞ (LLM –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞)"
           },
           preferred_time: {
             type: "string",
             description: "–ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è (–º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ—á–Ω—ã–º '10:00' –∏–ª–∏ –ø—Ä–∏–º–µ—Ä–Ω—ã–º '—É—Ç—Ä–æ–º', LLM –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–∑ –¥–∏–∞–ª–æ–≥–∞)"
           }
         },
         required: ["customer_name", "customer_phone", "car_info"]
       }
end
```

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç

```markdown
# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ Booking Creator Tool

## üéØ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å booking_creator tool:

–í—ã–∑—ã–≤–∞–π tool –∫–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç:
- –ü—Ä—è–º–æ –ø—Ä–æ—Å–∏—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è: "–∑–∞–ø–∏—Å–∞—Ç—å—Å—è", "—Ö–æ—á—É –Ω–∞ –æ—Å–º–æ—Ç—Ä", "–∫–æ–≥–¥–∞ –º–æ–∂–Ω–æ –ø—Ä–∏–µ—Ö–∞—Ç—å"
- –í—ã—Ä–∞–∂–∞–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏: "–æ—Ç–ª–∏—á–Ω–æ, —Ö–æ—á—É –∑–∞–ø–∏—Å–∞—Ç—å—Å—è", "–¥–∞–≤–∞–π –∑–∞–ø–∏—à–µ–º—Å—è"
- –°–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ –≤—Ä–µ–º–µ–Ω–∏: "–∞ –∫–æ–≥–¥–∞ –º–æ–∂–Ω–æ –∑–∞–µ—Ö–∞—Ç—å?", "–µ—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è?"

## üìã –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:

1. **–ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞:**
   - –£–∂–µ –∏–∑–≤–µ—Å—Ç–Ω—ã –ª–∏ –∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, –∞–≤—Ç–æ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π?
   - –ö–ª–∏–µ–Ω—Ç —É–∂–µ —É–ø–æ–º–∏–Ω–∞–ª —Å–≤–æ—é –º–∞—à–∏–Ω—É –∏–ª–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã?

2. **–°–æ–±–µ—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ:**
   ```
   –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç ‚Üí —Å–ø—Ä–æ—Å–∏:
   üöó –ú–∞—Ä–∫–∞, –º–æ–¥–µ–ª—å –∏ –≥–æ–¥ –≤–∞—à–µ–≥–æ –∞–≤—Ç–æ
   üìû –í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
   üìÖ –ù–∞ –∫–∞–∫—É—é –¥–∞—Ç—É –∑–∞–ø–∏—Å–∞—Ç—å—Å—è?
   ‚è∞ –£–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –¥–Ω—è?
   ```

3. **–í—ã–∑–æ–≤–∏ booking_creator tool** —Å —Å–æ–±—Ä–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
   ```json
   {
     "customer_name": "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä",
     "customer_phone": "+7(916)123-45-67",
     "car_info": {
       "brand": "Toyota",
       "model": "Camry",
       "year": 2018,
       "car_class": 2
     },
     "preferred_date": "28.10.2025",
     "preferred_time": "10:00-11:00"
   }
   ```
   *LLM —Å–∞–º–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–æ—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞*

## ‚è∞ –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç–∞:

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã:
- **–£—Ç—Ä–æ:** 10:00-11:00
- **–î–µ–Ω—å:** 14:00-15:00
- **–í–µ—á–µ—Ä:** 16:00-17:00

### –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:
- **–ë—É–¥–Ω–∏:** 9:00-20:00
- **–°—É–±–±–æ—Ç–∞:** 9:00-18:00
- **–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ:** –≤—ã—Ö–æ–¥–Ω–æ–π

### –î–ª—è LLM:
- LLM —Å–∞–º–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞
- –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å "–∑–∞–≤—Ç—Ä–∞ –≤ 10:00" –∏–ª–∏ "—É—Ç—Ä–æ–º"
- LLM —Å–∞–º–∞ –≤—ã–±–∏—Ä–∞–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Å–ª–æ—Ç –∏–ª–∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã
- –ù–∏–∫–∞–∫–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–ª–∏ –º–∞–ø–ø–∏–Ω–≥–∞ –≤ –∫–æ–¥–µ

**Product Constitution Compliance:** –í—Å—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –≤—Ä–µ–º–µ–Ω–µ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ LLM, –∞ –Ω–µ –≤ –∫–æ–¥–µ.

## ‚úÖ –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏:
–°–æ–æ–±—â–∏ –∫–ª–∏–µ–Ω—Ç—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã tool:
- –ü—Ä–∏ —É—Å–ø–µ—Ö–µ: –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏, –∞–¥—Ä–µ—Å, —á—Ç–æ –º–µ–Ω–µ–¥–∂–µ—Ä –ø–µ—Ä–µ–∑–≤–æ–Ω–∏—Ç
- –ü—Ä–∏ –æ—à–∏–±–∫–µ: –ø–æ–ø—Ä–æ—Å–∏ —É—Ç–æ—á–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞

**–í–∞–∂–Ω–æ:** –ù–µ —Å–æ–∑–¥–∞–≤–∞–π –∑–∞–ø–∏—Å—å –±–µ–∑ —è–≤–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫–ª–∏–µ–Ω—Ç–∞!
```

## ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–†–∏—Å–∫–∏:**
- [ ] **Low:** AI –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç intent –Ω–∞ –∑–∞–ø–∏—Å—å ‚Üí LLM –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ö–æ—Ä–æ—à–æ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
- [ ] **Low:** Tool extraction –æ—à–∏–±–∞–µ—Ç—Å—è —Å –¥–∞–Ω–Ω—ã–º–∏ ‚Üí –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ tool handler
- [ ] **Low:** –ú–µ–Ω–µ–¥–∂–µ—Ä—ã –Ω–µ –ø–æ–ª—É—á–∞—é—Ç –∑–∞—è–≤–∫–∏ ‚Üí retry –º–µ—Ö–∞–Ω–∏–∑–º –≤ Job
- [ ] **Low:** Time slot logic —Å–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–∞—è ‚Üí –º–æ–∂–Ω–æ —É—Å–ª–æ–∂–Ω–∏—Ç—å –ø–æ–∑–∂–µ

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Tool Approach:**
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—É–±—Ä–∞–ª–∏ TimeSlotService)
- ‚úÖ –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥ —á–µ—Ä–µ–∑ AI
- ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π extract –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- ‚úÖ –õ–µ–≥–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- [x] US-001 –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- [x] FIP-002a –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)
- [x] ruby_llm gem –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Telegram webhook —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ú–µ–Ω–µ–¥–∂–µ—Ä—Å–∫–∏–π —á–∞—Ç –¥–æ—Å—Ç—É–ø–µ–Ω

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ß—Ç–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**
- [ ] –ü–æ–ª–Ω—ã–π user journey: –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è ‚Üí –∑–∞–ø–∏—Å—å ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- [ ] –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞ (–∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, –∞–≤—Ç–æ)
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
- [ ] –§–æ—Ä–º–∞—Ç –∏ –¥–æ—Å—Ç–∞–≤–∫–∞ –∑–∞—è–≤–æ–∫ –≤ –º–µ–Ω–µ–¥–∂–µ—Ä—Å–∫–∏–π —á–∞—Ç
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π (–≤—Å–µ —Å–ª–æ—Ç—ã –∑–∞–Ω—è—Ç—ã, –Ω–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- [ ] Performance —Ç–µ—Å—Ç—ã (< 3 —Å–µ–∫—É–Ω–¥ –Ω–∞ –æ—Ç–≤–µ—Ç)
- [ ] –ö–æ–Ω–≤–µ—Ä—Å–∏–æ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (60% –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π ‚Üí –∑–∞–ø–∏—Å—å)

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

**Functional:**
- [ ] 60% –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –≤ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
- [ ] 90% —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç—Å—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏
- [ ] 95% –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–∞ –æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- [ ] –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö < 2 –º–∏–Ω—É—Ç

**Technical:**
- [ ] Response time < 3 seconds
- [ ] 99.9% –¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç–∏ –∑–∞—è–≤–æ–∫ –≤ –º–µ–Ω–µ–¥–∂–µ—Ä—Å–∫–∏–π —á–∞—Ç
- [ ] No data loss –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∑–∞–ø–∏—Å–∏
- [ ] Code coverage > 80%
- [ ] Zero critical errors –≤ production

## üì± –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã (MVP)

### –§–æ—Ä–º–∞—Ç —Å–ª–æ—Ç–æ–≤:
```yaml
schedule:
  tomorrow:
    morning:
      - start: "10:00"
        end: "11:00"
        available: 3
      - start: "11:00"
        end: "12:00"
        available: 2
    afternoon:
      - start: "14:00"
        end: "15:00"
        available: 3
      - start: "15:00"
        end: "16:00"
        available: 2
      - start: "16:00"
        end: "17:00"
        available: 1
  day_after_tomorrow:
    # –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```

**–í—Å–µ–≥–æ 10 —Å–ª–æ—Ç–æ–≤ –Ω–∞ 2 –¥–Ω—è** - —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ –¥–ª—è –æ–¥–Ω–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞

## üí¨ –ü—Ä–∏–º–µ—Ä –¥–∏–∞–ª–æ–≥–∞ (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)

```
–ö–ª–∏–µ–Ω—Ç: –î–∞, —Ö–æ—á—É –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –æ—Å–º–æ—Ç—Ä

–ë–æ—Ç: –û—Ç–ª–∏—á–Ω–æ! –î–ª—è –∑–∞–ø–∏—Å–∏ –º–Ω–µ –Ω—É–∂–Ω–∞ –Ω–µ–±–æ–ª—å—à–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è.
üöó –ú–∞—Ä–∫–∞, –º–æ–¥–µ–ª—å –∏ –≥–æ–¥ –∞–≤—Ç–æ:
üìû –í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:
üë§ –í–∞—à–µ –∏–º—è:

–ö–ª–∏–µ–Ω—Ç: Toyota Camry, 2018, +7(916)123-45-67, –ê–ª–µ–∫—Å–∞–Ω–¥—Ä

–ë–æ—Ç: –°–ø–∞—Å–∏–±–æ, –ê–ª–µ–∫—Å–∞–Ω–¥—Ä! üöó Toyota Camry 2018

–ü—Ä–µ–¥–ª–∞–≥–∞—é –¥–æ—Å—Ç—É–ø–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –æ—Å–º–æ—Ç—Ä–∞:
üìÖ –ó–∞–≤—Ç—Ä–∞ (27 –æ–∫—Ç—è–±—Ä—è):
  - 10:00 - 11:00 ‚úÖ
  - 14:00 - 15:00 ‚úÖ
  - 16:00 - 17:00 ‚úÖ

üìÖ –ü–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞ (28 –æ–∫—Ç—è–±—Ä—è):
  - 11:00 - 12:00 ‚úÖ
  - 15:00 - 16:00 ‚úÖ

–ö–∞–∫–æ–µ –≤—Ä–µ–º—è –≤–∞–º —É–¥–æ–±–Ω–æ?

–ö–ª–∏–µ–Ω—Ç: –ó–∞–≤—Ç—Ä–∞ –≤ 10:00

–ë–æ—Ç: ‚úÖ –ó–∞–ø–∏—Å–∞–ª –≤–∞—Å –Ω–∞ –∑–∞–≤—Ç—Ä–∞, 27 –æ–∫—Ç—è–±—Ä—è –≤ 10:00!
üìç –ê–¥—Ä–µ—Å: –≥. –ß–µ–±–æ–∫—Å–∞—Ä—ã, –Ø–¥—Ä–∏–Ω—Å–∫–æ–µ —à., 3
‚è∞ –ü–ª–∞–Ω–∏—Ä—É–µ–º–æ–µ –≤—Ä–µ–º—è –æ—Å–º–æ—Ç—Ä–∞: 30-40 –º–∏–Ω—É—Ç

–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–µ—Ä–µ–∑–≤–æ–Ω–∏—Ç –≤–∞–º –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏.
–û—Å–º–æ—Ç—Ä –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∏ –Ω–∏ –∫ —á–µ–º—É –Ω–µ –æ–±—è–∑—ã–≤–∞–µ—Ç.

[–§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞: BookingNotificationJob ‚Üí Manager Chat]
```

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### Booking –º–æ–¥–µ–ª—å:
```ruby
class Booking < ApplicationRecord
  belongs_to :telegram_user
  belongs_to :chat, optional: true

  # –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞
  validates :customer_name, presence: true
  validates :customer_phone, presence: true, format: { with: PHONE_REGEX }
  validates :car_brand, :car_model, :car_year, presence: true

  # –í—Ä–µ–º—è –∏ —Å—Ç–∞—Ç—É—Å
  validates :scheduled_at, presence: true
  validates :status, presence: true, inclusion: { in: %w[pending confirmed cancelled completed] }

  enum status: { pending: 'pending', confirmed: 'confirmed', cancelled: 'cancelled', completed: 'completed' }

  # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  store :metadata, accessors: [:dialog_context, :services_discussed, :cost_estimate]

  scope :upcoming, -> { where('scheduled_at > ?', Time.current).where(status: :confirmed) }
  scope :for_date, ->(date) { where(scheduled_at: date.all_day) }
end
```

## üìã Manager Chat Notification Format

```markdown
üöó –ù–û–í–ê–Ø –ó–ê–Ø–í–ö–ê –ù–ê –û–°–ú–û–¢–†

üë§ –ö–ª–∏–µ–Ω—Ç: –ê–ª–µ–∫—Å–∞–Ω–¥—Ä (@username)
üìû –¢–µ–ª–µ—Ñ–æ–Ω: +7(916)123-45-67

üöó –ê–≤—Ç–æ–º–æ–±–∏–ª—å: Toyota Camry, 2018
‚è∞ –í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏: –ó–∞–≤—Ç—Ä–∞ (27.10) –≤ 10:00
üìç –ê–¥—Ä–µ—Å: –≥. –ß–µ–±–æ–∫—Å–∞—Ä—ã, –Ø–¥—Ä–∏–Ω—Å–∫–æ–µ —à., 3

üìù –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞:
–ö–ª–∏–µ–Ω—Ç –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–ª—Å—è —Å—Ç–æ–∏–º–æ—Å—Ç—å—é —Ä–µ–º–æ–Ω—Ç–∞ –≤–º—è—Ç–∏–Ω—ã –Ω–∞ –ø–µ—Ä–µ–¥–Ω–µ–π –ª–µ–≤–æ–π –¥–≤–µ—Ä–∏.
–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å PDR: 7000-10000‚ÇΩ

üîó –°—Å—ã–ª–∫–∞ –Ω–∞ –¥–∏–∞–ª–æ–≥: [telegram —Å—Å—ã–ª–∫–∞]

‚ö° –°–†–û–ß–ù–û: –ü–µ—Ä–µ–∑–≤–æ–Ω–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è!
```

---

**Implementation notes:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É FIP-002a –∫–∞–∫ –æ—Å–Ω–æ–≤—É
- Focus –Ω–∞ –ø–ª–∞–≤–Ω–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ –æ—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –∫ –∑–∞–ø–∏—Å–∏
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–æ–∫ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

**Change log:**
| –î–∞—Ç–∞ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-----------|
| 25.10.2025 | Initial version from US-002b requirements |
| | |