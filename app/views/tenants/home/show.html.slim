h1.text-2xl.font-bold.text-gray-800.mb-6 –û–±–∑–æ—Ä

= turbo_frame_tag "dashboard_stats" do
  / KPI –ö–∞—Ä—Ç–æ—á–∫–∏
  .grid.grid-cols-1.md:grid-cols-2.lg:grid-cols-4.gap-6
    / Clients card ‚Äî –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è
    = link_to tenant_clients_path, class: "bg-white rounded-lg shadow p-6 hover:shadow-lg transition-shadow block"
      .flex.items-center.justify-between
        .text-sm.font-medium.text-gray-500 –ö–ª–∏–µ–Ω—Ç—ã
        span.text-2xl üë•
      .text-3xl.font-bold.text-gray-800.mt-2 = @stats.clients_total
      .text-sm.mt-1
        span.text-green-600 +#{@stats.clients_today} —Å–µ–≥–æ–¥–Ω—è
        span.text-gray-400.mx-1 ‚Ä¢
        span.text-green-600 +#{@stats.clients_week} –∑–∞ –Ω–µ–¥–µ–ª—é

    / Bookings card ‚Äî –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è
    = link_to tenant_bookings_path, class: "bg-white rounded-lg shadow p-6 hover:shadow-lg transition-shadow block"
      .flex.items-center.justify-between
        .text-sm.font-medium.text-gray-500 –ó–∞—è–≤–∫–∏
        span.text-2xl üìù
      .text-3xl.font-bold.text-gray-800.mt-2 = @stats.bookings_total
      .text-sm.text-green-600.mt-1 +#{@stats.bookings_today} —Å–µ–≥–æ–¥–Ω—è

    / Active chats card
    .bg-white.rounded-lg.shadow.p-6
      .flex.items-center.justify-between
        .text-sm.font-medium.text-gray-500 –ê–∫—Ç–∏–≤–Ω—ã–µ —á–∞—Ç—ã
        span.text-2xl üí¨
      .text-3xl.font-bold.text-gray-800.mt-2 = @stats.active_chats
      .text-sm.text-gray-500.mt-1 –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24—á

    / Messages today card
    .bg-white.rounded-lg.shadow.p-6
      .flex.items-center.justify-between
        .text-sm.font-medium.text-gray-500 –°–æ–æ–±—â–µ–Ω–∏–π —Å–µ–≥–æ–¥–Ω—è
        span.text-2xl üì®
      .text-3xl.font-bold.text-gray-800.mt-2 = @stats.messages_today

  / –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
  .mt-8.bg-white.rounded-lg.shadow.p-6 data-controller="chart"
    .flex.items-center.justify-between.mb-4
      h2.text-lg.font-semibold.text-gray-800 üìà –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
      .flex.gap-2
        = link_to "7 –¥–Ω–µ–π", tenant_root_path(period: 7), data: { turbo_frame: "dashboard_stats" }, class: "px-3 py-1 text-sm rounded transition-colors #{@period == 7 ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}"
        = link_to "30 –¥–Ω–µ–π", tenant_root_path(period: 30), data: { turbo_frame: "dashboard_stats" }, class: "px-3 py-1 text-sm rounded transition-colors #{@period == 30 ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}"
        = link_to "90 –¥–Ω–µ–π", tenant_root_path(period: 90), data: { turbo_frame: "dashboard_stats" }, class: "px-3 py-1 text-sm rounded transition-colors #{@period == 90 ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}"
        = link_to "–í—Å—ë –≤—Ä–µ–º—è", tenant_root_path(period: "all"), data: { turbo_frame: "dashboard_stats" }, class: "px-3 py-1 text-sm rounded transition-colors #{@period.nil? ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}"

    .h-64
      canvas data-chart-target="canvas" data-chart-labels=@stats.chart_data[:labels].to_json data-chart-values=@stats.chart_data[:values].to_json

  / –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∏
  .mt-8.bg-white.rounded-lg.shadow.p-6
    h2.text-lg.font-semibold.text-gray-800.mb-4 üïê –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∏

    - if @stats.recent_chats.any?
      .space-y-4
        - @stats.recent_chats.each do |chat|
          .border.rounded-lg.p-4.hover:bg-gray-50.transition-colors
            / –ó–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞
            .flex.items-center.justify-between.mb-3
              .flex.items-center.gap-2
                span.text-sm.font-medium.text-gray-800 = chat.client.display_name
                - if chat.messages.any?
                  span.text-xs.text-gray-400 = time_ago_in_words(chat.messages.last.created_at) + " –Ω–∞–∑–∞–¥"

            / –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞
            - if chat.messages.any?
              .space-y-2.pl-2.border-l-2.border-gray-200
                - chat.messages.order(created_at: :desc).limit(4).reverse.each do |msg|
                  .flex.items-start.gap-2
                    span.text-xs.flex-shrink-0 = msg.role == "user" ? "üë§" : "ü§ñ"
                    p.text-sm.text-gray-600.truncate = truncate(msg.content, length: 60)
    - else
      .text-center.py-8
        p.text-gray-500 –î–∏–∞–ª–æ–≥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç
        p.text-sm.text-gray-400.mt-1 –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç—ã –Ω–∞—á–Ω—É—Ç –æ–±—â–∞—Ç—å—Å—è —Å –±–æ—Ç–æ–º, –∑–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –∏—Ö –¥–∏–∞–ª–æ–≥–∏
