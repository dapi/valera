# Technical Specification: TS-002 - Telegram Service Booking Engine

**–°—Ç–∞—Ç—É—Å:** Approved
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** High
**–í–µ—Ä—Å–∏—è:** 1.0
**–°–æ–∑–¥–∞–Ω:** 25.10.2025
**–ê–≤—Ç–æ—Ä:** Technical Lead
**–†–µ–≤—å—é–≤–µ—Ä:** Senior Developer

## üìã –û–±–∑–æ—Ä (Overview)

### –û–ø–∏—Å–∞–Ω–∏–µ
–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è AI-–¥–≤–∏–∂–∫–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ —É—Å–ª—É–≥–∏ –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–∞ —á–µ—Ä–µ–∑ Telegram. –°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç LLM –¥–ª—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞—è–≤–∫–∏ –≤ –º–µ–Ω–µ–¥–∂–µ—Ä—Å–∫–∏–π —á–∞—Ç.

### –¶–µ–ª–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ —Å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –¥–∏–∞–ª–æ–≥–æ–º
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã –¥–ª—è –∫—É–∑–æ–≤–Ω—ã—Ö —Ä–∞–±–æ—Ç
- [ ] –°–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ—Ä–∑–∏–Ω—É —É—Å–ª—É–≥ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞
- [ ] –û–±–µ—Å–ø–µ—á–∏—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É –∑–∞—è–≤–æ–∫ —Å retry –º–µ—Ö–∞–Ω–∏–∑–º–æ–º
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π ruby_llm –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö
```
Telegram Bot ‚Üí Webhook Endpoint ‚Üí TelegramController ‚Üí TelegramWebhookService
                                                                                     ‚Üì
                                                                            TelegramUser Model
                                                                                     ‚Üì
                                                                               Chat Model (ruby_llm)
                                                                                     ‚Üì
                                                                          AI Response Generation
                                                                                     ‚Üì
                                                                               Telegram Bot Client
                                                                                     ‚Üì
                                                                               Response to User

Booking Flow:
Chat Context ‚Üí Service Extraction ‚Üí Booking Model ‚Üí BookingJob ‚Üí Manager Chat
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
- **TelegramUser:** –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram
- **Chat:** –î–∏–∞–ª–æ–≥ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π ruby_llm
- **Booking:** –ó–∞—è–≤–∫–∞ –Ω–∞ —É—Å–ª—É–≥–∏

#### 2. Service —Å–ª–æ–∏
- **TelegramWebhookService:** –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook –∑–∞–ø—Ä–æ—Å–æ–≤
- **BookingJob:** –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–æ–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º

#### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- **ruby_llm:** AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
- **Telegram API:** –û—Ç–ø—Ä–∞–≤–∫–∞/–ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- **Solid Queue:** –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **FR-001:** –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥ —Å –∫–ª–∏–µ–Ω—Ç–æ–º —á–µ—Ä–µ–∑ ruby_llm
- **FR-002:** –í–∫–ª—é—á–µ–Ω–∏–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Ü–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
- **FR-003:** –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã —É—Å–ª—É–≥ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞
- **FR-004:** –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫
- **FR-005:** –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –∏ —Ü–µ–Ω
- **FR-006:** –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ Solid Queue

### –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ AI < 5 —Å–µ–∫—É–Ω–¥
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–æ–∫
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 100+ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
- **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å:** Graceful degradation –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ AI
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** Bugsnag –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –æ—à–∏–±–æ–∫

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### TelegramUser –º–æ–¥–µ–ª—å
**–¢–∞–±–ª–∏—Ü–∞:** `telegram_users`
**Primary key:** `id` (telegram user id)

**–ü–æ–ª—è:**
- `id` (bigint, primary key) - Telegram user ID
- `first_name` (string) - –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `last_name` (string) - –§–∞–º–∏–ª–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `username` (string) - @username –≤ Telegram
- `photo_url` (string) - URL –∞–≤–∞—Ç–∞—Ä–∞
- `language_code` (string) - –Ø–∑—ã–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `is_bot` (boolean) - –§–ª–∞–≥ –±–æ—Ç–∞
- `is_premium` (boolean) - –§–ª–∞–≥ premium
- `last_contact_at` (timestamp) - –ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–Ω—Ç–∞–∫—Ç

**–°–≤—è–∑–∏:**
- `has_many :chats`
- `has_many :bookings`

**–ò–Ω–¥–µ–∫—Å—ã:**
- `username`
- `last_contact_at`

### Chat –º–æ–¥–µ–ª—å
**–¢–∞–±–ª–∏—Ü–∞:** `chats` (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π ruby_llm –º–æ–¥–µ–ª–∏)

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:**
- `telegram_user_id` (bigint, foreign key) - –°–≤—è–∑—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- `telegram_chat_id` (bigint) - ID —á–∞—Ç–∞ –≤ Telegram
- `chat_type` (string) - –¢–∏–ø —á–∞—Ç–∞ (private, group)

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- `acts_as_chat` (ruby_llm)
- `belongs_to :telegram_user`

### Booking –º–æ–¥–µ–ª—å
**–¢–∞–±–ª–∏—Ü–∞:** `bookings`

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è:**
- `id` (bigint, primary key)
- `telegram_user_id` (bigint, foreign key)
- `chat_id` (bigint, foreign key, optional)
- `customer_name` (string) - –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞
- `customer_phone` (string) - –¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞
- `customer_telegram_username` (string) - Telegram username

**–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≤—Ç–æ–º–æ–±–∏–ª–µ:**
- `car_brand` (string) - –ú–∞—Ä–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- `car_model` (string) - –ú–æ–¥–µ–ª—å –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- `car_year` (integer) - –ì–æ–¥ –≤—ã–ø—É—Å–∫–∞
- `car_class` (string) - –ö–ª–∞—Å—Å –∞–≤—Ç–æ–º–æ–±–∏–ª—è (1/2/3)

**–£—Å–ª—É–≥–∏ –∏ —Ü–µ–Ω—ã:**
- `services` (json) - –ú–∞—Å—Å–∏–≤ —É—Å–ª—É–≥ —Å —Ü–µ–Ω–∞–º–∏
- `total_price` (decimal) - –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å

**–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è:**
- `preferred_time` (text) - –ñ–µ–ª–∞–µ–º–æ–µ –≤—Ä–µ–º—è
- `problem_description` (text) - –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

**–°—Ç–∞—Ç—É—Å—ã:**
- `status` (string) - pending, confirmed, cancelled, completed
- `sent_to_manager_at` (timestamp)
- `manager_confirmed_at` (timestamp)
- `completed_at` (timestamp)

**–ò–Ω–¥–µ–∫—Å—ã:**
- `status`
- `created_at`
- `telegram_user_id`
- `[status, created_at]`

### –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã
**–¶–µ–Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (MVP):**
```ruby
PDR_REPAIR = {
  small: { size: "–¥–æ 5 —Å–º", price: 5000..7000, time: "1 –¥–µ–Ω—å" },
  medium: { size: "5-15 —Å–º", price: 7000..10000, time: "1-2 –¥–Ω—è" },
  large: { size: "15-25 —Å–º", price: 10000..15000, time: "2 –¥–Ω—è" }
}

LOCAL_PAINTING = {
  small: { area: "–¥–æ 1–º¬≤", price: 8000..12000, time: "2 –¥–Ω—è" },
  large: { area: "1-2–º¬≤", price: 12000..18000, time: "3 –¥–Ω—è" }
}

POLISHING = {
  partial: { area: "–æ—Ç–¥–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã", price: 4000..6000, time: "2-3 —á–∞—Å–∞" },
  full: { area: "–≤–µ—Å—å –∫—É–∑–æ–≤", price: 8000..12000, time: "1 –¥–µ–Ω—å" }
}
```

**–ü–æ–¥—Ö–æ–¥ —Å –≤–∫–ª—é—á–µ–Ω–∏–µ–º –≤ –ø—Ä–æ–º–ø—Ç:**
- **–¶–µ–Ω–æ–≤—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã** –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
- **AI —Å–∞–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é** –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è
- **–ì–∏–±–∫–æ—Å—Ç—å —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è** - –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å** - AI –≤—ã–±–∏—Ä–∞–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é

## üåê AI/LLM –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### ruby_llm –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö ENV –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤–∫–ª—é—á–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –æ–∫–Ω–æ: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞: 2000 —Ç–æ–∫–µ–Ω–æ–≤

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- **Sliding window:** –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- **Service extraction:** –í—ã–¥–µ–ª–µ–Ω–∏–µ —É—Å–ª—É–≥ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
- **Cart management:** –ö–æ—Ä–∑–∏–Ω–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ –¥–∏–∞–ª–æ–≥–∞

### –ü—Ä–æ–º–ø—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- –ë–∞–∑–æ–≤—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç + –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é –∫–ª–∞—Å—Å–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å –∫–æ—Ä–∑–∏–Ω–æ–π —É—Å–ª—É–≥
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –∑–∞—è–≤–æ–∫

## üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- **ruby_llm gem:** AI/LLM —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- **rails application:** Existing –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **solid_queue:** –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
- **anyway_config:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã

### –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
- **Telegram Bot API:** –û—Ç–ø—Ä–∞–≤–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- **Bugsnag:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫
- **–ú–µ–Ω–µ–¥–∂–µ—Ä—Å–∫–∏–π Telegram —á–∞—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫

### Webhook endpoint
- **URL:** `/api/v1/telegram/webhook`
- **–ú–µ—Ç–æ–¥:** POST
- **–§–æ—Ä–º–∞—Ç:** JSON (Telegram Webhook)
- **–û—Ç–≤–µ—Ç:** HTTP 200 OK

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è: 1000 —Å–∏–º–≤–æ–ª–æ–≤
- Rate limiting: 10 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ë–∞–∑–æ–≤–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- Graceful degradation –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ AI
- Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–æ–∫
- Bugsnag –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏
- AI response time
- Booking requestÊàêÂäüÁéá
- Context tokens usage
- –û—à–∏–±–∫–∏ –∏ performance –ø—Ä–æ–±–ª–µ–º—ã

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∑–∞—è–≤–æ–∫
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ AI –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤

## üöÄ Deployment

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- Manager chat ID —á–µ—Ä–µ–∑ ENV
- CSV —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `data/`
- Telegram webhook —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### Environment –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è ruby_llm
- `MANAGER_TELEGRAM_CHAT_ID`
- `BOOKING_ENABLED`

## ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| AI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | Graceful degradation, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Bugsnag |
| –ü—Ä–∞–π—Å-–ª–∏—Å—Ç –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | Fallback –Ω–∞ –±–∞–∑–æ–≤—ã–π –Ω–∞–±–æ—Ä —É—Å–ª—É–≥ |
| –ú–µ–Ω–µ–¥–∂–µ—Ä –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –∑–∞—è–≤–∫—É | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | Retry –º–µ—Ö–∞–Ω–∏–∑–º, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—á–µ—Ä–µ–¥–µ–π |
| –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ–µ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–µ–∑–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ |
| AI –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç CSV | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ–µ | –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–æ–º–ø—Ç–∞ —Å —á–µ—Ç–∫–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ |

## üîÑ Roadmap —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ —ç—Ç–∞–ø—ã

### üöÄ –≠—Ç–∞–ø 1 (MVP - 1 –Ω–µ–¥–µ–ª—è)
**–û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- [x] AI –¥–∏–∞–ª–æ–≥ —Å ruby_llm
- [x] –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
- [x] –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- [x] –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–æ–∫ —á–µ—Ä–µ–∑ Solid Queue
- [x] –ë–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–£—Ä–µ–∑–∞–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è MVP:**
- –ü—Ä–æ—Å—Ç–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ CSV –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
- –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–º–ø—Ç—ã –±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –ü—Ä–æ—Å—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –±–µ–∑ retry

### ‚ö° –≠—Ç–∞–ø 2 (–£–ª—É—á—à–µ–Ω–∏—è - 2-3 –Ω–µ–¥–µ–ª–∏)
**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
- [ ] –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–ª–∏–Ω—ã –æ—Ç–≤–µ—Ç–æ–≤ AI
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –æ–∫–Ω–∞
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ —Å –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–æ–º
- [ ] –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ CSV –¥–ª—è –ø—Ä–æ–º–ø—Ç–æ–≤

**–ö–∞—á–µ—Å—Ç–≤–æ AI:**
- [ ] –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π –º–æ–¥–µ–ª–∏
- [ ] Fallback —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ AI
- [ ] –£–ª—É—á—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –ª—É—á—à–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **User Story:** [US-002-telegram-service-booking.md](../user-stories/US-002-telegram-service-booking.md)
- **Feature Description:** [feature-telegram-service-booking.md](../features/feature-telegram-service-booking.md)
- **Implementation Plan:** [protocol-telegram-service-booking.md](../../.protocols/protocol-telegram-service-booking.md) (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω)
- **Ruby LLM Documentation:** [../../gems/ruby_llm/README.md](../../gems/ruby_llm/README.md)
- **Telegram Bot Documentation:** [../../gems/telegram-bot/README.md](../../gems/telegram-bot/README.md)

## üìã –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

1. **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∫–æ—Ä–∑–∏–Ω–∞** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
2. **Async –æ—Ç–ø—Ä–∞–≤–∫–∞** - –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ Solid Queue
3. **–ü—Ä–∞–π—Å-–ª–∏—Å—Ç –≤ –ø—Ä–æ–º–ø—Ç–µ** - AI —Å–∞–º —Ä–∞–∑–±–∏—Ä–∞–µ—Ç –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ
4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ruby_llm** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å—ã –¥–ª—è MVP
- –ü—Ä–æ—Å—Ç–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ CSV –≤ –ø—Ä–æ–º–ø—Ç –≤–º–µ—Å—Ç–æ —Å–ª–æ–∂–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
- –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–º–ø—Ç—ã –≤–º–µ—Å—Ç–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ—Å—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–º–µ—Å—Ç–æ comprehensive fallback

---

**–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
- 25.10.2025 21:00 - v1.0: –°–æ–∑–¥–∞–Ω–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ User Story –∏ Feature Description
- 25.10.2025 23:00 - v1.1: –£–ø—Ä–æ—â–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–¥–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- 25.10.2025 23:15 - v1.1: –§–æ–∫—É—Å –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞–Ω–Ω—ã—Ö –∏ –º–æ–¥–µ–ª—è—Ö