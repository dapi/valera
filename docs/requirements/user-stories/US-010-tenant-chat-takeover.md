# User Story: US-010 - ะฏะฒะฝะฐั ะฟะตัะตะดะฐัะฐ ะดะธะฐะปะพะณะฐ ะพั ะฑะพัะฐ ะบ ะผะตะฝะตะดะถะตัั

**ะกัะฐััั:** Draft
**ะัะธะพัะธัะตั:** Medium
**Story Points:** 8
**ะกะพะทะดะฐะฝ:** 28.12.2025
**ะะฑะฝะพะฒะปะตะฝ:** 28.12.2025
**GitHub Issue:** #103

## User Story

**As a** ะผะตะฝะตะดะถะตั ะฐะฒัะพัะตัะฒะธัะฐ, ะฟัะพัะผะฐััะธะฒะฐััะธะน ัะฐัั ั ะบะปะธะตะฝัะฐะผะธ ะฒ tenant dashboard
**I want to** ะธะผะตัั ะฒะพะทะผะพะถะฝะพััั "ะฟะตัะตัะฒะฐัะธัั" ะดะธะฐะปะพะณ ั AI-ะฑะพัะฐ ะธ ะพัะฒะตัะธัั ะบะปะธะตะฝัั ะปะธัะฝะพ
**so that** ั ะผะพะณั ัะตัะธัั ัะปะพะถะฝัะต ัะธััะฐัะธะธ, ะบะพัะพััะต ะฑะพั ะฝะต ะผะพะถะตั ะพะฑัะฐะฑะพัะฐัั (ะบะพะฝัะปะธะบัั, VIP-ะบะปะธะตะฝัั, ะฝะตััะฐะฝะดะฐััะฝัะต ะทะฐะฟัะพัั)

## ะะธะทะฝะตั-ะบะพะฝัะตะบัั

### ะัะพะฑะปะตะผะฐ
AI-ะฑะพั ัััะตะบัะธะฒะตะฝ ะฒ 85-95% ัะปััะฐะตะฒ, ะฝะพ ะฝะต ัะฟัะฐะฒะปัะตััั ั:
- **ะะพะฝัะปะธะบัะฐะผะธ:** ะฝะตะดะพะฒะพะปัััะฒะพ ัะตะฝะพะน, ะบะฐัะตััะฒะพะผ, ััะพะบะฐะผะธ
- **VIP-ะบะปะธะตะฝัะฐะผะธ:** ะฟะตััะพะฝะฐะปัะฝัะน ะฟะพะดัะพะด, ะฝะตััะฐะฝะดะฐััะฝัะต ะทะฐะบะฐะทั
- **ะกัะพัะฝัะผะธ ะธะทะผะตะฝะตะฝะธัะผะธ:** ะฟะตัะตะฝะพั ะทะฐะฟะธัะธ ะฒะฝะต ัะปะพัะพะฒ
- **ะขะตัะฝะธัะตัะบะธะผะธ ะฒะพะฟัะพัะฐะผะธ:** ะณะปัะฑะพะบะฐั ัะบัะฟะตััะธะทะฐ ะผะฐััะตัะฐ

### ะกะพะพัะฒะตัััะฒะธะต Product Constitution
- AI ะพััะฐัััั **ะพัะฝะพะฒะฝัะผ** ะธะฝัะตััะตะนัะพะผ (ะผะตะฝะตะดะถะตั ะฒะผะตัะธะฒะฐะตััั < 5% ะดะธะฐะปะพะณะพะฒ)
- ะะปะธะตะฝัั **ัะฒะฝะพ ัะพะพะฑัะฐะตััั** ะพ ะฟะตัะตะบะปััะตะฝะธะธ ะฝะฐ ัะตะปะพะฒะตะบะฐ
- ะะธะฐะปะพะณ ะพััะฐัััั **ะตััะตััะฒะตะฝะฝัะผ** (ะฑะตะท ะบะฝะพะฟะพะบ ะดะปั ะบะปะธะตะฝัะฐ)

## User Acceptance Criteria

### Functional Criteria (ะขะตัะฝะธัะตัะบะธะต ััะตะฑะพะฒะฐะฝะธั)

#### ะะตัะตัะฒะฐั ะดะธะฐะปะพะณะฐ
- [ ] **Given** ะผะตะฝะตะดะถะตั ะฟัะพัะผะฐััะธะฒะฐะตั ัะฐั ะฒ tenant dashboard **When** ะพะฝ ะฝะฐะถะธะผะฐะตั ะบะฝะพะฟะบั "ะะทััั ะดะธะฐะปะพะณ" **Then** ะดะธะฐะปะพะณ ะฟะตัะตัะพะดะธั ะฒ ัะตะถะธะผ "manager_mode"
- [ ] **Given** ะดะธะฐะปะพะณ ะฒ ัะตะถะธะผะต "manager_mode" **When** ััะพ ะฟัะพะธััะพะดะธั **Then** AI-ะฑะพั ะฟัะตะบัะฐัะฐะตั ะฐะฒัะพะผะฐัะธัะตัะบะธะต ะพัะฒะตัั ะฒ ััะพะผ ัะฐัะต
- [ ] **Given** ะดะธะฐะปะพะณ ะฟะตัะตัะฒะฐัะตะฝ **When** ััะพ ะฟัะพะธััะพะดะธั **Then** ะบะปะธะตะฝัั ะพัะฟัะฐะฒะปัะตััั ัะพะพะฑัะตะฝะธะต: "ะะฐั ะฟะตัะตะบะปััะธะปะธ ะฝะฐ ะผะตะฝะตะดะถะตัะฐ. ะกะตะนัะฐั ั ะฒะฐะผะธ ะพะฑัะฐะตััั [ะะผั]"

#### ะัะฟัะฐะฒะบะฐ ัะพะพะฑัะตะฝะธะน ะผะตะฝะตะดะถะตัะพะผ
- [ ] **Given** ะดะธะฐะปะพะณ ะฒ ัะตะถะธะผะต "manager_mode" **When** ะผะตะฝะตะดะถะตั ะฒะฒะพะดะธั ัะตะบัั ะธ ะฝะฐะถะธะผะฐะตั "ะัะฟัะฐะฒะธัั" **Then** ัะพะพะฑัะตะฝะธะต ััะพะดะธั ะบะปะธะตะฝัั ะฒ Telegram
- [ ] **Given** ัะพะพะฑัะตะฝะธะต ะพัะฟัะฐะฒะปะตะฝะพ **When** ััะพ ะฟัะพะธััะพะดะธั **Then** ะพะฝะพ ะพัะพะฑัะฐะถะฐะตััั ะฒ ะธััะพัะธะธ ัะฐัะฐ ั ะฟะพะผะตัะบะพะน "[ะะตะฝะตะดะถะตั]"
- [ ] **Given** ะผะตะฝะตะดะถะตั ะพัะฟัะฐะฒะปัะตั ัะพะพะฑัะตะฝะธะต **When** ะพะฝะพ ะดะพััะฐะฒะปะตะฝะพ **Then** ะบะปะธะตะฝั ะฒะธะดะธั ะตะณะพ ะบะฐะบ ะพะฑััะฝะพะต ัะพะพะฑัะตะฝะธะต ะพั ะฑะพัะฐ (ะฑะตะท ัะตัะฝะธัะตัะบะธั ะผะฐัะบะตัะพะฒ)

#### ะะพะทะฒัะฐั ะดะธะฐะปะพะณะฐ ะฑะพัั
- [ ] **Given** ะดะธะฐะปะพะณ ะฒ ัะตะถะธะผะต "manager_mode" **When** ะผะตะฝะตะดะถะตั ะฝะฐะถะธะผะฐะตั "ะะตัะฝััั ะฑะพัั" **Then** ัะตะถะธะผ "manager_mode" ัะฝะธะผะฐะตััั
- [ ] **Given** ะดะธะฐะปะพะณ ะฒะพะทะฒัะฐััะฝ ะฑะพัั **When** ััะพ ะฟัะพะธััะพะดะธั **Then** ะบะปะธะตะฝัั ะพัะฟัะฐะฒะปัะตััั: "ะกะฟะฐัะธะฑะพ ะทะฐ ะพะฑัะฐัะตะฝะธะต! ะัะปะธ ะฑัะดัั ะฒะพะฟัะพัั โ AI-ะฐััะธััะตะฝั ะฒัะตะณะดะฐ ะฝะฐ ัะฒัะทะธ"
- [ ] **Given** ะดะธะฐะปะพะณ ะฒะพะทะฒัะฐััะฝ ะฑะพัั **When** ะบะปะธะตะฝั ะฟะธัะตั ะฝะพะฒะพะต ัะพะพะฑัะตะฝะธะต **Then** AI-ะฑะพั ะพัะฒะตัะฐะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ

#### ะะฒัะพ-ะฒะพะทะฒัะฐั (ัะฐะนะผะฐัั)
- [ ] **Given** ะดะธะฐะปะพะณ ะฒ ัะตะถะธะผะต "manager_mode" **When** ะผะตะฝะตะดะถะตั ะฝะต ะพัะฟัะฐะฒะปัะป ัะพะพะฑัะตะฝะธั 30 ะผะธะฝัั **Then** ะดะธะฐะปะพะณ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฒะพะทะฒัะฐัะฐะตััั ะฑะพัั
- [ ] **Given** ะฟัะธะฑะปะธะถะฐะตััั ัะฐะนะผะฐัั (25 ะผะธะฝ) **When** ะผะตะฝะตะดะถะตั ะฐะบัะธะฒะตะฝ ะฒ dashboard **Then** ะฟะพัะฒะปัะตััั ะฟัะตะดัะฟัะตะถะดะตะฝะธะต "ะะธะฐะปะพะณ ะฒะตัะฝัััั ะฑะพัั ัะตัะตะท 5 ะผะธะฝัั"
- [ ] **Given** ะฐะฒัะพ-ะฒะพะทะฒัะฐั ะฟัะพะธะทะพััะป **When** ััะพ ะฟัะพะธััะพะดะธั **Then** ัะพะฑััะธะต ะปะพะณะธััะตััั ะฒ audit log

### User Acceptance Criteria (ะะพะปัะทะพะฒะฐัะตะปััะบะธะต ะบัะธัะตัะธะธ)

#### ะะปั ะผะตะฝะตะดะถะตัะฐ
- [ ] **ะะฐะบ ะผะตะฝะตะดะถะตั** ั ะฒะธะถั ัััะบะธะน ะธะฝะดะธะบะฐัะพั, ััะพ ะดะธะฐะปะพะณ ะฒ ัะตะถะธะผะต "manager_mode"
- [ ] **ะะฐะบ ะผะตะฝะตะดะถะตั** ั ะฟะพะฝะธะผะฐั, ัะบะพะปัะบะพ ะฒัะตะผะตะฝะธ ะพััะฐะปะพัั ะดะพ ะฐะฒัะพ-ะฒะพะทะฒัะฐัะฐ
- [ ] **ะะฐะบ ะผะตะฝะตะดะถะตั** ั ะผะพะณั ะปะตะณะบะพ ะฝะฐะนัะธ ะฒัะต "ะฟะตัะตัะฒะฐัะตะฝะฝัะต" ะผะฝะพะน ะดะธะฐะปะพะณะธ

#### ะะปั ะบะปะธะตะฝัะฐ
- [ ] **ะะฐะบ ะบะปะธะตะฝั** ั ะฟะพะฝะธะผะฐั, ััะพ ัะตะฟะตัั ะพะฑัะฐััั ั ัะตะปะพะฒะตะบะพะผ, ะฐ ะฝะต ั ะฑะพัะพะผ
- [ ] **ะะฐะบ ะบะปะธะตะฝั** ั ะฟะพะปััะฐั ะฟะตััะพะฝะฐะปัะฝัั ะฟะพะผะพัั ะฒ ัะปะพะถะฝะพะน ัะธััะฐัะธะธ
- [ ] **ะะฐะบ ะบะปะธะตะฝั** ั ะฟะพะฝะธะผะฐั, ะบะพะณะดะฐ ะดะธะฐะปะพะณ ะฒะตัะฝัะปัั ะบ ะฑะพัั

### Performance Criteria (ะขัะตะฑะพะฒะฐะฝะธั ะบ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ)
- [ ] **Takeover time:** < 1 ัะตะบัะฝะดะฐ ะดะปั ะฟะตัะตัะฒะฐัะฐ ะดะธะฐะปะพะณะฐ
- [ ] **Message delivery:** < 2 ัะตะบัะฝะดั ะดะปั ะพัะฟัะฐะฒะบะธ ัะพะพะฑัะตะฝะธั ะผะตะฝะตะดะถะตัะฐ
- [ ] **UI update:** < 500ms ะดะปั ะพะฑะฝะพะฒะปะตะฝะธั ัะพััะพัะฝะธั ะฒ dashboard

### Analytics Criteria (ะขัะตะฑะพะฒะฐะฝะธั ะบ ะฐะฝะฐะปะธัะธะบะต)
- [ ] **Given** ะผะตะฝะตะดะถะตั ะฟะตัะตัะฒะฐััะฒะฐะตั ะดะธะฐะปะพะณ **When** ััะพ ะฟัะพะธััะพะดะธั **Then** ัะพะฑััะธะต `chat_takeover_started` ะพััะปะตะถะธะฒะฐะตััั
- [ ] **Given** ะผะตะฝะตะดะถะตั ะฒะพะทะฒัะฐัะฐะตั ะดะธะฐะปะพะณ **When** ััะพ ะฟัะพะธััะพะดะธั **Then** ัะพะฑััะธะต `chat_takeover_ended` ะพััะปะตะถะธะฒะฐะตััั ั duration
- [ ] **Given** ะฟัะพะธััะพะดะธั ะฐะฒัะพ-ะฒะพะทะฒัะฐั **When** ััะพ ะฟัะพะธััะพะดะธั **Then** ัะพะฑััะธะต `chat_takeover_timeout` ะพััะปะตะถะธะฒะฐะตััั

## Use Cases

### UC-1: ะญัะบะฐะปะฐัะธั ะฟัะธ ะฝะตะดะพะฒะพะปัััะฒะต ะบะปะธะตะฝัะฐ

**ะัะตะดััะปะพะฒะธะต:** ะะปะธะตะฝั ะฒััะฐะถะฐะตั ะฝะตะดะพะฒะพะปัััะฒะพ ัะตะฝะพะน ะฒ ัะฐัะต

**ะกัะตะฝะฐัะธะน:**
1. ะะปะธะตะฝั: "ะญัะพ ัะปะธัะบะพะผ ะดะพัะพะณะพ! ะฅะพัั ะฟะพะณะพะฒะพัะธัั ั ัะตะปะพะฒะตะบะพะผ!"
2. ะะตะฝะตะดะถะตั ะฒะธะดะธั ะดะธะฐะปะพะณ ะฒ dashboard
3. ะะตะฝะตะดะถะตั ะฝะฐะถะธะผะฐะตั "ะะทััั ะดะธะฐะปะพะณ"
4. ะะปะธะตะฝัั: "ะะฐั ะฟะตัะตะบะปััะธะปะธ ะฝะฐ ะผะตะฝะตะดะถะตัะฐ. ะกะตะนัะฐั ั ะฒะฐะผะธ ะพะฑัะฐะตััั ะะฝะฝะฐ"
5. ะะตะฝะตะดะถะตั: "ะะดัะฐะฒััะฒัะนัะต! ะะพะฝะธะผะฐั ะฒะฐั. ะะฐะฒะฐะนัะต ะพะฑััะดะธะผ ะฟะตััะพะฝะฐะปัะฝัั ัะบะธะดะบั..."
6. ะะปะธะตะฝั ัะพะณะปะฐัะฐะตััั ะฝะฐ ะทะฐะฟะธัั
7. ะะตะฝะตะดะถะตั ะฝะฐะถะธะผะฐะตั "ะะตัะฝััั ะฑะพัั"
8. ะะปะธะตะฝัั: "ะกะฟะฐัะธะฑะพ ะทะฐ ะพะฑัะฐัะตะฝะธะต! ะัะปะธ ะฑัะดัั ะฒะพะฟัะพัั โ AI-ะฐััะธััะตะฝั ะฒัะตะณะดะฐ ะฝะฐ ัะฒัะทะธ"

**ะะตะทัะปััะฐั:** ะะปะธะตะฝั ัะพััะฐะฝัะฝ, ะบะพะฝะฒะตััะธั +15%

### UC-2: VIP-ะบะปะธะตะฝั ั ะพัะพะฑัะผ ะทะฐะฟัะพัะพะผ

**ะัะตะดััะปะพะฒะธะต:** VIP-ะบะปะธะตะฝั ัะพัะตั ัะบัะบะปัะทะธะฒะฝัั ััะปัะณั

**ะกัะตะฝะฐัะธะน:**
1. VIP-ะบะปะธะตะฝั: "ะัะถะฝะฐ ะฟะพะบัะฐัะบะฐ ะฒ ัะตะดะบะธะน ัะฒะตั Racing Green Metallic"
2. AI-ะฑะพั ะดะฐัั ััะฐะฝะดะฐััะฝัะน ะพัะฒะตั ะพ ะฟะพะบัะฐัะบะต
3. ะะปะฐะดะตะปะตั ะฒะธะดะธั VIP-ะผะตัะบั ะธ ะฟะตัะตัะฒะฐััะฒะฐะตั ะดะธะฐะปะพะณ
4. ะะปะฐะดะตะปะตั: "ะะพะฑััะน ะดะตะฝั! ะะฐะฑะพัะฐะตะผ ั ัะบัะบะปัะทะธะฒะฝัะผะธ ัะฒะตัะฐะผะธ. ะะฐััะบะฐะถะธัะต ะฟะพะดัะพะฑะฝะตะต..."
5. ะะตัะตะณะพะฒะพัั ะธ ะพัะพัะผะปะตะฝะธะต ะทะฐะบะฐะทะฐ
6. ะะปะฐะดะตะปะตั ะฒะพะทะฒัะฐัะฐะตั ะดะธะฐะปะพะณ ะฑะพัั

**ะะตะทัะปััะฐั:** ะััะพะบะพะผะฐัะถะธะฝะฐะปัะฝัะน ะทะฐะบะฐะท ัะพััะฐะฝัะฝ

### UC-3: ะะฒัะพ-ะฒะพะทะฒัะฐั ะฟัะธ ะทะฐะฑััะพะผ ะดะธะฐะปะพะณะต

**ะัะตะดััะปะพะฒะธะต:** ะะตะฝะตะดะถะตั ะฟะตัะตัะฒะฐัะธะป ะดะธะฐะปะพะณ, ะฝะพ ะพัะฒะปัะบัั

**ะกัะตะฝะฐัะธะน:**
1. ะะตะฝะตะดะถะตั ะฟะตัะตัะฒะฐััะฒะฐะตั ะดะธะฐะปะพะณ ะฒ 14:00
2. ะะตะฝะตะดะถะตั ะพัะฟัะฐะฒะปัะตั ะพะดะฝะพ ัะพะพะฑัะตะฝะธะต
3. ะะตะฝะตะดะถะตั ะพัะฒะปะตะบะฐะตััั ะฝะฐ ะดััะณะธะต ะทะฐะดะฐัะธ
4. ะ 14:25 ะฟะพัะฒะปัะตััั ะฟัะตะดัะฟัะตะถะดะตะฝะธะต "ะะธะฐะปะพะณ ะฒะตัะฝัััั ะฑะพัั ัะตัะตะท 5 ะผะธะฝ"
5. ะ 14:30 ะดะธะฐะปะพะณ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฒะพะทะฒัะฐัะฐะตััั ะฑะพัั
6. ะะปะธะตะฝัั: "ะกะฟะฐัะธะฑะพ ะทะฐ ะพะฑัะฐัะตะฝะธะต! ะัะปะธ ะฑัะดัั ะฒะพะฟัะพัั โ AI-ะฐััะธััะตะฝั ะฒัะตะณะดะฐ ะฝะฐ ัะฒัะทะธ"
7. ะกะพะฑััะธะต ะปะพะณะธััะตััั: `chat_takeover_timeout`

**ะะตะทัะปััะฐั:** ะะปะธะตะฝั ะฝะต "ะทะฐะฒะธั" ะฑะตะท ะพัะฒะตัะฐ

## Business Value

### ะะตััะธะบะธ ััะฟะตัะฐ
| ะะตััะธะบะฐ | ะะพ | ะะพัะปะต | ะะทะผะตะฝะตะฝะธะต |
|---------|-----|-------|-----------|
| Conversion Rate (ัะปะพะถะฝัะต ะบะตะนัั) | 50% | 85% | +35% |
| Customer Satisfaction | 80% | 92% | +12% |
| VIP Retention | 85% | 95% | +10% |
| Avg Response Time (ััะบะฐะปะฐัะธะธ) | N/A | < 5 ะผะธะฝ | ะะพะฒะพะต |

### KPIs ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ
- **Takeover Rate:** < 5% ะดะธะฐะปะพะณะพะฒ ััะตะฑััั ะฒะผะตัะฐัะตะปัััะฒะฐ (ะตัะปะธ ะฑะพะปััะต โ ะฟัะพะฑะปะตะผะฐ ั AI)
- **Resolution Rate:** 90%+ ะฟะตัะตัะฒะฐัะตะฝะฝัั ะดะธะฐะปะพะณะพะฒ ะทะฐะฒะตััะฐัััั ะบะพะฝะฒะตััะธะตะน
- **Avg Takeover Duration:** < 15 ะผะธะฝัั
- **Timeout Rate:** < 10% ะฐะฒัะพ-ะฒะพะทะฒัะฐัะพะฒ (ะตัะปะธ ะฑะพะปััะต โ ะผะตะฝะตะดะถะตัั ะฟะตัะตะณััะถะตะฝั)

## ะัะบะปััะตะฝะธั ะธ Edge Cases

- [ ] **ะะตัะบะพะปัะบะพ ะผะตะฝะตะดะถะตัะพะฒ ะพะดะฝะพะฒัะตะผะตะฝะฝะพ:** ะขะพะปัะบะพ ะพะดะธะฝ ะผะพะถะตั ะฟะตัะตัะฒะฐัะธัั ะดะธะฐะปะพะณ (ะบะฝะพะฟะบะฐ ะฑะปะพะบะธััะตััั)
- [ ] **ะะตะฝะตะดะถะตั ะฒััะตะป ะธะท ัะธััะตะผั:** ะะฒัะพ-ะฒะพะทะฒัะฐั ะฝะตะผะตะดะปะตะฝะฝะพ ั ัะฒะตะดะพะผะปะตะฝะธะตะผ ะดััะณะธะผ ะผะตะฝะตะดะถะตัะฐะผ
- [ ] **ะะปะธะตะฝั ะฝะต ะพัะฒะตัะฐะตั:** ะะตะฝะตะดะถะตั ะผะพะถะตั ะฒะตัะฝััั ะดะธะฐะปะพะณ ะฑะพัั ะฒ ะปัะฑะพะน ะผะพะผะตะฝั
- [ ] **ะกะฟะฐะผ ะพั ะบะปะธะตะฝัะฐ:** Rate limiting ัะฐะฑะพัะฐะตั ะธ ะดะปั ัะตะถะธะผะฐ "manager_mode"
- [ ] **ะัะธะฑะบะฐ ะพัะฟัะฐะฒะบะธ:** Retry ะผะตัะฐะฝะธะทะผ + ัะฒะตะดะพะผะปะตะฝะธะต ะผะตะฝะตะดะถะตัั

## ะขะตัะฝะธัะตัะบะธะต ััะตะฑะพะฒะฐะฝะธั

### ะะพะดะตะปั ะดะฐะฝะฝัั
```ruby
# ะะพะฑะฐะฒะธัั ะฒ Chat
class Chat < ApplicationRecord
  enum :mode, { ai_mode: 0, manager_mode: 1 }, default: :ai_mode

  belongs_to :taken_by, class_name: 'User', optional: true

  # ะัะตะผั ะฟะตัะตัะฒะฐัะฐ ะดะปั ัะฐััััะฐ ัะฐะนะผะฐััะฐ
  attribute :taken_at, :datetime
end
```

### API Endpoints
```ruby
# config/routes.rb
namespace :tenants do
  resources :chats do
    member do
      post :takeover      # ะะตัะตัะฒะฐัะธัั ะดะธะฐะปะพะณ
      post :release       # ะะตัะฝััั ะฑะพัั
      post :send_message  # ะัะฟัะฐะฒะธัั ัะพะพะฑัะตะฝะธะต
    end
  end
end
```

### Background Job ะดะปั ัะฐะนะผะฐััะฐ
```ruby
# app/jobs/chat_takeover_timeout_job.rb
class ChatTakeoverTimeoutJob < ApplicationJob
  def perform(chat_id)
    chat = Chat.find(chat_id)
    return unless chat.manager_mode?
    return if chat.taken_at > 30.minutes.ago

    chat.release_to_bot!(timeout: true)
  end
end
```

## Definition of Done

- [ ] ะัะต Functional Criteria ะฒัะฟะพะปะฝะตะฝั ะธ ะฟัะพัะตััะธัะพะฒะฐะฝั
- [ ] ะัะต User Acceptance Criteria ะฟะพะดัะฒะตัะถะดะตะฝั
- [ ] Performance Criteria ะธะทะผะตัะตะฝั ะธ ะดะพััะธะณะฝััั
- [ ] Analytics events ัะตะฐะปะธะทะพะฒะฐะฝั ะธ ัะฐะฑะพัะฐัั
- [ ] Unit ัะตััั ะดะปั takeover/release ะปะพะณะธะบะธ ะฝะฐะฟะธัะฐะฝั
- [ ] Integration ัะตััั ะฟะพะปะฝะพะณะพ flow ะฟัะพัะพะดัั
- [ ] UI responsive ะฝะฐ ะผะพะฑะธะปัะฝัั ััััะพะนััะฒะฐั
- [ ] Audit log ะดะปั ะฒัะตั ะพะฟะตัะฐัะธะน
- [ ] Code review ะฒัะฟะพะปะฝะตะฝ
- [ ] ะะพะบัะผะตะฝัะฐัะธั ะพะฑะฝะพะฒะปะตะฝะฐ

## UI/UX Requirements

### Dashboard - ะกะฟะธัะพะบ ัะฐัะพะฒ
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะงะฐัั                    [ะกะพััะธัะพะฒะบะฐ โผ] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ๐ข ะะฒะฐะฝ ะะตััะพะฒ         โ AI mode       โ
โ  ะะฐะฟะธัั ะฝะฐ ะขะ...                        โ
โ  14:23                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ๐ ะะฐัะธั ะกะธะดะพัะพะฒะฐ      โ Manager mode  โ
โ  [ะะฝะฝะฐ] ะะฐะบะธะต ัะตะฝั...                   โ
โ  12:45    โฑ๏ธ 15:23                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Dashboard - ะะบัะธะฒะฝัะน ัะฐั (AI mode)
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะฒะฐะฝ ะะตััะพะฒ                            โ
โ  +7 (900) 123-45-67                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ          โ
โ  ๐ค ะะดัะฐะฒััะฒัะนัะต, ัะพัั ะทะฐะฟะธัะฐัััั...    โ
โ  ๐ค ะะพะฑััะน ะดะตะฝั! ะะพะฝะตัะฝะพ...             โ
โ                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ  [ ๐ฏ ะะทััั ะดะธะฐะปะพะณ ]            โ    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Dashboard - ะะบัะธะฒะฝัะน ัะฐั (Manager mode)
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ ะะฐัะธั ะกะธะดะพัะพะฒะฐ  โฑ๏ธ ะััะฐะปะพัั: 25:00  โ
โ  +7 (900) 987-65-43                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ          โ
โ  ๐ค ะกะปะธัะบะพะผ ะดะพัะพะณะพ!                     โ
โ  ๐ค [ะกะธััะตะผะฐ] ะะฐั ะฟะตัะตะบะปััะธะปะธ ะฝะฐ ะะฝะฝั   โ
โ  ๐ ะะดัะฐะฒััะฒัะนัะต! ะะฐะฒะฐะนัะต ะพะฑััะดะธะผ...    โ
โ                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ [ะะฒะตะดะธัะต ัะพะพะฑัะตะฝะธะต...]          โ    โ
โ  โ                    [ะัะฟัะฐะฒะธัั]  โ    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ  [ ๐ ะะตัะฝััั ะฑะพัั ]            โ    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ะกะฒัะทะฐะฝะฝัะต ะดะพะบัะผะตะฝัั

- **Technical Design:** [TSD-011-tenant-chat-takeover.md](../tsd/TSD-011-tenant-chat-takeover.md)
- **GitHub Issue:** [#103](https://github.com/dapi/valera/issues/103)
- **Prerequisite:** [#102 - ะะฐะทะดะตะป ะงะฐัั](https://github.com/dapi/valera/issues/102) (CLOSED)
- **Product Constitution:** [constitution.md](../../product/constitution.md)
- **Tenant Chats:** ะกััะตััะฒัััะธะน `Tenants::ChatsController`

## ะะธัะบะธ ะธ ะผะธัะธะณะฐัะธะธ

| ะะธัะบ | ะะตัะพััะฝะพััั | ะะปะธัะฝะธะต | ะะธัะธะณะฐัะธั |
|------|-------------|---------|-----------|
| ะะตะฝะตะดะถะตัั ะทะปะพัะฟะพััะตะฑะปััั (ัะฟะฐะผ) | ะะธะทะบะฐั | ะััะพะบะฐั | Audit log, ะปะธะผะธัั, ะฐะปะตััั |
| ะกะฝะธะถะตะฝะธะต ะธัะฟะพะปัะทะพะฒะฐะฝะธั AI | ะกัะตะดะฝัั | ะกัะตะดะฝัั | KPI ะฝะฐ takeover rate < 5% |
| ะะตะฝะตะดะถะตั ะทะฐะฑัะฒะฐะตั ะฒะตัะฝััั | ะััะพะบะฐั | ะกัะตะดะฝัั | ะะฒัะพ-ะฒะพะทะฒัะฐั 30 ะผะธะฝ + ะฟัะตะดัะฟัะตะถะดะตะฝะธะต |
| ะะพะฝัะปะธะบั ัะพะพะฑัะตะฝะธะน | ะะธะทะบะฐั | ะััะพะบะฐั | ะฏะฒะฝัะน ัะตะถะธะผ, AI ะฑะปะพะบะธััะตััั |

## ะคะฐะทั ัะตะฐะปะธะทะฐัะธะธ

### ะคะฐะทะฐ 1: MVP (3-4 ะดะฝั)
- [ ] ะะพะดะตะปั ะดะฐะฝะฝัั (mode, taken_by, taken_at)
- [ ] ะะฐะทะพะฒัะน takeover/release API
- [ ] ะัะฟัะฐะฒะบะฐ ัะพะพะฑัะตะฝะธะน ะผะตะฝะตะดะถะตัะพะผ
- [ ] UI ะบะฝะพะฟะบะธ ะฒ dashboard

### ะคะฐะทะฐ 2: ะะพะปะธัะพะฒะบะฐ (2-3 ะดะฝั)
- [ ] ะะฒัะพ-ะฒะพะทะฒัะฐั ั ัะฐะนะผะฐััะพะผ
- [ ] ะฃะฒะตะดะพะผะปะตะฝะธั ะธ ะฟัะตะดัะฟัะตะถะดะตะฝะธั
- [ ] Analytics events
- [ ] Audit log

### ะคะฐะทะฐ 3: ะะฟัะธะผะธะทะฐัะธั (ะฟะพัะปะต launch)
- [ ] AI-ะดะตัะตะบัะธั "ะฟัะพะฑะปะตะผะฝัั" ะดะธะฐะปะพะณะพะฒ
- [ ] Push-ัะฒะตะดะพะผะปะตะฝะธั ะผะตะฝะตะดะถะตัะฐะผ
- [ ] VIP-ะผะตัะบะธ ะดะปั ะบะปะธะตะฝัะพะฒ

---

**Change log:**
| ะะฐัะฐ | ะะตััะธั | ะะทะผะตะฝะตะฝะธะต | ะะฒัะพั |
|------|--------|-----------|-------|
| 28.12.2025 | 1.0 | Initial version based on issue #103 analysis | Claude Code |

---

**Approval:**
- [ ] Product Owner: ____________________ Date: _______
- [ ] Tech Lead: ________________________ Date: _______

**Implementation Notes:**
- **Story Points:** 8 (Complexity: High, Risk: Medium)
- **Estimated Time:** 5-7 ะดะฝะตะน
- **Dependencies:** #102 ะดะพะปะถะตะฝ ะฑััั ะทะฐะฒะตัััะฝ (CLOSED โ)
