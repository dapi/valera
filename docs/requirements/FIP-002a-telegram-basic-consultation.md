# Feature Implementation Plan: FIP-002a - Telegram Basic Consultation

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** High
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** Simple
**–°—Ç–∞—Ç—É—Å:** Draft
**–°–æ–∑–¥–∞–Ω:** 25.10.2025
**–û–±–Ω–æ–≤–ª–µ–Ω:** 25.10.2025
**User Story:** US-002a-telegram-basic-consultation.md

## üéØ User Story

**As a** –≤–ª–∞–¥–µ–ª–µ—Ü –∞–≤—Ç–æ–º–æ–±–∏–ª—è —Å –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏ –∫—É–∑–æ–≤–∞, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—á–µ—Ç —É–∑–Ω–∞—Ç—å –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ–º–æ–Ω—Ç–∞
**I want to** –ø–æ–ª—É—á–∏—Ç—å –±—ã—Å—Ç—Ä—É—é —Ç–µ–∫—Å—Ç–æ–≤—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –ø–æ –∫—É–∑–æ–≤–Ω–æ–º—É —Ä–µ–º–æ–Ω—Ç—É —á–µ—Ä–µ–∑ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥
**so that** —è –º–æ–≥—É –ø–æ–Ω—è—Ç—å –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ –æ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–∞—Ö

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏
- [ ] **Functional:** –ö–ª–∏–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–º ‚Üí –±–æ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å
- [ ] **User Experience:** 80% –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–∞—é—Ç —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –∑–∞ 1 –¥–∏–∞–ª–æ–≥
- [ ] **Performance:** –û—Ç–≤–µ—Ç –±–æ—Ç–∞ < 3 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Ç–∏–ø–∏—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

## üèóÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```yaml
components:
  - name: "TelegramWebhookController"
    type: "Controller"
    responsibility: "–ü—Ä–∏–µ–º –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ webhook –æ—Ç Telegram"
  - name: "ConsultationService"
    type: "Service"
    responsibility: "–û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ ruby_llm"
  - name: "PricingService"
    type: "Service"
    responsibility: "–†–∞—Å—á–µ—Ç —Ü–µ–Ω –ø–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º"
  - name: "Chat/Message –º–æ–¥–µ–ª–∏"
    type: "Model (ruby_llm)"
    responsibility: "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤"
```

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **Framework:** Ruby on Rails 8.1
- **AI:** ruby_llm gem (acts_as_chat, acts_as_message)
- **External:** Telegram API
- **Database:** PostgreSQL

### Data Flow
```mermaid
graph LR
    A[User Message] --> B[TelegramWebhookController]
    B --> C[ConsultationService]
    C --> D[ruby_llm Chat]
    D --> E[PricingService]
    E --> F[Response Generation]
    F --> G[Telegram API]
    G --> H[User]
```

## üìã –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Phase 1: Foundation (1 –¥–µ–Ω—å)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å ConsultationService
- [ ] –°–æ–∑–¥–∞—Ç—å PricingService —Å —Ü–µ–Ω–∞–º–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å system prompts –¥–ª—è ruby_llm
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Chat/Message –º–æ–¥–µ–ª–∏

### Phase 2: Integration (1 –¥–µ–Ω—å)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º TelegramWebhookController
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤

### Phase 3: Polish (0.5 –¥–Ω—è)
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å prompts
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

## ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–†–∏—Å–∫–∏:**
- [ ] **Low:** AI –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è
- [ ] **Low:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç —Ç–æ—á–Ω—É—é —Ü–µ–Ω—É
- [ ] **Low:** –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- [x] US-001 –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- [ ] ruby_llm gem –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Telegram webhook —Ä–∞–±–æ—Ç–∞–µ—Ç

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ß—Ç–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**
- [ ] –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –∑–∞–ø—Ä–æ—Å–æ–≤ (–≤–º—è—Ç–∏–Ω–∞, —Ü–∞—Ä–∞–ø–∏–Ω–∞, –ø–æ–∫—Ä–∞—Å–∫–∞)
- [ ] –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞
- [ ] –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ü–µ–Ω–æ–≤—ã—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –°–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ (< 3 —Å–µ–∫—É–Ω–¥)

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

**Functional:**
- [ ] 80% –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–∞—é—Ç —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –∑–∞ 1 –¥–∏–∞–ª–æ–≥
- [ ] –ë–æ—Ç –ø–æ–Ω–∏–º–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –∫—É–∑–æ–≤–Ω—ã—Ö –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π
- [ ] –û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–µ —Ü–µ–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä—ã–Ω–æ—á–Ω—ã–º

**Technical:**
- [ ] Response time < 3 seconds
- [ ] No critical errors
- [ ] Code coverage > 80%
- [ ] Dialogs —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ ruby_llm

## üí∞ –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã (MVP)

### PDR (—Ä–µ–º–æ–Ω—Ç –±–µ–∑ –ø–æ–∫—Ä–∞—Å–∫–∏):
- –ú–∞–ª–µ–Ω—å–∫–∞—è –≤–º—è—Ç–∏–Ω–∞ (–¥–æ 5 —Å–º): 5000-7000‚ÇΩ
- –°—Ä–µ–¥–Ω—è—è –≤–º—è—Ç–∏–Ω–∞ (5-15 —Å–º): 7000-10000‚ÇΩ
- –ë–æ–ª—å—à–∞—è –≤–º—è—Ç–∏–Ω–∞ (15-25 —Å–º): 10000-15000‚ÇΩ

### –õ–æ–∫–∞–ª—å–Ω–∞—è –ø–æ–∫—Ä–∞—Å–∫–∞:
- –≠–ª–µ–º–µ–Ω—Ç –¥–æ 1–º¬≤: 8000-12000‚ÇΩ
- –≠–ª–µ–º–µ–Ω—Ç 1-2–º¬≤: 12000-18000‚ÇΩ

### –ü–æ–ª–∏—Ä–æ–≤–∫–∞ –∫—É–∑–æ–≤–∞:
- –ß–∞—Å—Ç–∏—á–Ω–∞—è –ø–æ–ª–∏—Ä–æ–≤–∫–∞: 4000-6000‚ÇΩ
- –ü–æ–ª–Ω–∞—è –ø–æ–ª–∏—Ä–æ–≤–∫–∞: 8000-12000‚ÇΩ

## üí¨ –ü—Ä–∏–º–µ—Ä –¥–∏–∞–ª–æ–≥–∞

```
–ö–ª–∏–µ–Ω—Ç: –ü—Ä–∏–≤–µ—Ç! –ï—Å—Ç—å –≤–º—è—Ç–∏–Ω–∞ –Ω–∞ –¥–≤–µ—Ä–∏, —Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –ø–æ—á–∏–Ω–∏—Ç—å?

–ë–æ—Ç: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ü–æ–º–æ–≥—É —Å–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏.
üöó –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ:
- –ö–∞–∫–∞—è –¥–≤–µ—Ä—å (–ø–µ—Ä–µ–¥–Ω—è—è/–∑–∞–¥–Ω—è—è, –ª–µ–≤–∞—è/–ø—Ä–∞–≤–∞—è)?
- –ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≤–º—è—Ç–∏–Ω—ã?
- –ö—Ä–∞—Å–∫–∞ —Ü–µ–ª–∞—è –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞?

–ö–ª–∏–µ–Ω—Ç: –ü–µ—Ä–µ–¥–Ω—è—è –ª–µ–≤–∞—è, —Ä–∞–∑–º–µ—Ä–æ–º —Å –ª–∞–¥–æ–Ω—å, –∫—Ä–∞—Å–∫–∞ —Ü–µ–ª–∞—è

–ë–æ—Ç: –ü–æ–Ω—è–ª! –≠—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å–ª—É—á–∞–π –¥–ª—è PDR (—Ä–µ–º–æ–Ω—Ç –±–µ–∑ –ø–æ–∫—Ä–∞—Å–∫–∏).
üí∞ –û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: 7000-10000‚ÇΩ
‚è∞ –°—Ä–æ–∫ —Ä–µ–º–æ–Ω—Ç–∞: 1-2 –¥–Ω—è

–¢–æ—á–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞–∑–æ–≤–µ–º –ø–æ—Å–ª–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –æ—Å–º–æ—Ç—Ä–∞ - —ç—Ç–æ –Ω–∏ –∫ —á–µ–º—É –Ω–µ –æ–±—è–∑—ã–≤–∞–µ—Ç. –•–æ—Ç–∏—Ç–µ, —Ä–∞—Å—Å–∫–∞–∂—É –∫–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è?
```

---

**Implementation notes:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É US-001
- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ service –∫–ª–∞—Å—Å—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è core logic
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã —Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞—Ö –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥–µ
- Focus –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º –¥–∏–∞–ª–æ–≥–µ (Product Constitution compliance)

**Change log:**
| –î–∞—Ç–∞ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-----------|
| 25.10.2025 | Initial version from US-002a |
| | |